

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Dolfyn Module &mdash; MHKiT v0.5.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/mhkit.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Utils Module" href="api.utils.html" />
    <link rel="prev" title="Loads Module" href="api.loads.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> MHKiT
          

          
          </a>

          
            
            
              <div class="version">
                v0.5.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terminology.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qc.html">QC Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wave.html">Wave Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../river.html">River Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tidal.html">Tidal Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power.html">Power Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loads.html">Loads Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dolfyn.html">Dolfyn Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">Utils Module</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../python.html">MHKiT-Python</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../python.html#installation">Installation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../python.html#api-documentation">API Documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="api.qc.html">QC Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.wave.html">Wave Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.river.html">River Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.tidal.html">Tidal Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.power.html">Power Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.loads.html">Loads Module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Dolfyn Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#io">IO</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rotate">Rotate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#time">Time</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api.utils.html">Utils Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../python.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python.html#online-forum">Online Forum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python.html#software-tests">Software Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../matlab.html">MHKiT-MATLAB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../webinars.html">Webinars</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citeus.html">Cite Us</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">Online Forum</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MHKiT</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../python.html">MHKiT-Python</a> &raquo;</li>
        
      <li>Dolfyn Module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/mhkit-python/api.dolfyn.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="dolfyn-module">
<span id="dolfyn-api"></span><h1>Dolfyn Module<a class="headerlink" href="#dolfyn-module" title="Permalink to this headline">¶</a></h1>
<p>The dolfyn module contains a set of functions to injest binary Nortek or RDI files.</p>
<p><strong>Instrument datafiles</strong> are processed and returned as an xarray dataset.</p>
<span class="target" id="module-mhkit.dolfyn"></span><div class="section" id="io">
<h2>IO<a class="headerlink" href="#io" title="Permalink to this headline">¶</a></h2>
<p>The io submodule contains the following functions to read
binary Nortek (e.g., .VEC, .wpr, .ad2cp, etc.) or RDI
(.000, .PD0, .ENX, etc.) data file.</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.read" title="mhkit.dolfyn.io.api.read"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read</span></code></a></p></td>
<td><p>Read a binary Nortek (e.g., .VEC, .wpr, .ad2cp, etc.) or RDI (.000, .PD0, .ENX, etc.) data file.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.read_example" title="mhkit.dolfyn.io.api.read_example"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read_example</span></code></a></p></td>
<td><p>Read an ADCP or ADV datafile from the examples directory.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.save" title="mhkit.dolfyn.io.api.save"><code class="xref py py-obj docutils literal notranslate"><span class="pre">save</span></code></a></p></td>
<td><p>Save xarray dataset as netCDF (.nc).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.load" title="mhkit.dolfyn.io.api.load"><code class="xref py py-obj docutils literal notranslate"><span class="pre">load</span></code></a></p></td>
<td><p>Load xarray dataset from netCDF (.nc)</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.save_mat" title="mhkit.dolfyn.io.api.save_mat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">save_mat</span></code></a></p></td>
<td><p>Save xarray dataset as a MATLAB (.mat) file</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.io.api.load_mat" title="mhkit.dolfyn.io.api.load_mat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">load_mat</span></code></a></p></td>
<td><p>Load xarray dataset from MATLAB (.mat) file, complimentary to <cite>save_mat()</cite></p></td>
</tr>
</tbody>
</table>
<span class="target" id="module-mhkit.dolfyn.io.api"></span><dl class="py function">
<dt id="mhkit.dolfyn.io.api.read">
<code class="sig-prename descclassname">mhkit.dolfyn.io.api.</code><code class="sig-name descname">read</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fname</span></em>, <em class="sig-param"><span class="n">userdata</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">nens</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/io/api.html#read"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mhkit.dolfyn.io.api.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a binary Nortek (e.g., .VEC, .wpr, .ad2cp, etc.) or RDI
(.000, .PD0, .ENX, etc.) data file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<em>string</em>) – Filename of instrument file to read.</p></li>
<li><p><strong>userdata</strong> (True, False, or string of userdata.json filename (default <code class="docutils literal notranslate"><span class="pre">True</span></code>)) – Whether to read the ‘&lt;base-filename&gt;.userdata.json’ file.</p></li>
<li><p><strong>nens</strong> (<em>None</em><em> (</em><em>default: read entire file</em><em>)</em><em>, </em><em>int</em><em>, or </em><em>2-element tuple</em><em> (</em><em>start</em><em>, </em><em>stop</em><em>)</em>) – Number of pings or ensembles to read from the file</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset</em>) – An xarray dataset from instrument datafile.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mhkit.dolfyn.io.api.read_example">
<code class="sig-prename descclassname">mhkit.dolfyn.io.api.</code><code class="sig-name descname">read_example</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/io/api.html#read_example"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mhkit.dolfyn.io.api.read_example" title="Permalink to this definition">¶</a></dt>
<dd><p>Read an ADCP or ADV datafile from the examples directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> (<em>str</em>) – <p>A few available files:</p>
<blockquote>
<div><p>AWAC_test01.wpr
BenchFile01.ad2cp
RDI_test01.000
burst_mode01.VEC
vector_data01.VEC
vector_data_imu01.VEC
winriver01.PD0
winriver02.PD0</p>
</div></blockquote>
</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset</em>) – An xarray dataset from the binary instrument data.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mhkit.dolfyn.io.api.save">
<code class="sig-prename descclassname">mhkit.dolfyn.io.api.</code><code class="sig-name descname">save</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ds</span></em>, <em class="sig-param"><span class="n">filename</span></em>, <em class="sig-param"><span class="n">format</span><span class="o">=</span><span class="default_value">'NETCDF4'</span></em>, <em class="sig-param"><span class="n">engine</span><span class="o">=</span><span class="default_value">'netcdf4'</span></em>, <em class="sig-param"><span class="n">compression</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/io/api.html#save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mhkit.dolfyn.io.api.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save xarray dataset as netCDF (.nc).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – </p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Filename and/or path with the ‘.nc’ extension</p></li>
<li><p><strong>compression</strong> (<em>bool</em><em> (</em><em>default: False</em><em>)</em>) – When true, compress all variables with zlib complevel=1.</p></li>
<li><p><strong>**kwargs</strong> (these are passed directly to <code class="xref py py-func docutils literal notranslate"><span class="pre">xarray.Dataset.to_netcdf()</span></code>) – </p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Drops ‘config’ lines.</p>
<p>More detailed compression options can be specified by specifying
‘encoding’ in kwargs. The values in encoding will take precedence
over whatever is set according to the compression option above.
See the xarray.to_netcdf documentation for more details.</p>
</dd></dl>

<dl class="py function">
<dt id="mhkit.dolfyn.io.api.load">
<code class="sig-prename descclassname">mhkit.dolfyn.io.api.</code><code class="sig-name descname">load</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">filename</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/io/api.html#load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mhkit.dolfyn.io.api.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Load xarray dataset from netCDF (.nc)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>str</em>) – Filename and/or path with the ‘.nc’ extension</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset</em>) – An xarray dataset from the binary instrument data.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mhkit.dolfyn.io.api.save_mat">
<code class="sig-prename descclassname">mhkit.dolfyn.io.api.</code><code class="sig-name descname">save_mat</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ds</span></em>, <em class="sig-param"><span class="n">filename</span></em>, <em class="sig-param"><span class="n">datenum</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/io/api.html#save_mat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mhkit.dolfyn.io.api.save_mat" title="Permalink to this definition">¶</a></dt>
<dd><p>Save xarray dataset as a MATLAB (.mat) file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – Data to save</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Filename and/or path with the ‘.mat’ extension</p></li>
<li><p><strong>datenum</strong> (<em>bool</em>) – If true, converts time to datenum. If false, time will be saved
in “epoch time”.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The xarray data format is saved as a MATLAB structure with the fields
‘vars, coords, config, units’.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.io.savemat()</span></code></p>
</div>
</dd></dl>

<dl class="py function">
<dt id="mhkit.dolfyn.io.api.load_mat">
<code class="sig-prename descclassname">mhkit.dolfyn.io.api.</code><code class="sig-name descname">load_mat</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">filename</span></em>, <em class="sig-param"><span class="n">datenum</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/io/api.html#load_mat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mhkit.dolfyn.io.api.load_mat" title="Permalink to this definition">¶</a></dt>
<dd><p>Load xarray dataset from MATLAB (.mat) file, complimentary to <cite>save_mat()</cite></p>
<p>A .mat file must contain the fields: {vars, coords, config, units},
where ‘coords’ contain the dimensions of all variables in ‘vars’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<em>str</em>) – Filename and/or path with the ‘.mat’ extension</p></li>
<li><p><strong>datenum</strong> (<em>bool</em>) – If true, converts time from datenum. If false, converts time from
“epoch time”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset</em>) – An xarray dataset from the binary instrument data.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.io.loadmat()</span></code></p>
</div>
</dd></dl>

</div>
<div class="section" id="rotate">
<h2>Rotate<a class="headerlink" href="#rotate" title="Permalink to this headline">¶</a></h2>
<p>The rotate submodule contains tools to rotate a dataset
to a new coordinate system.</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.api.rotate2" title="mhkit.dolfyn.rotate.api.rotate2"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rotate2</span></code></a></p></td>
<td><p>Rotate a dataset to a new coordinate system.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.api.calc_principal_heading" title="mhkit.dolfyn.rotate.api.calc_principal_heading"><code class="xref py py-obj docutils literal notranslate"><span class="pre">calc_principal_heading</span></code></a></p></td>
<td><p>Compute the principal angle of the horizontal velocity.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#mhkit.dolfyn.rotate.api.set_declination" title="mhkit.dolfyn.rotate.api.set_declination"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_declination</span></code></a></p></td>
<td><p>Set the magnetic declination</p></td>
</tr>
</tbody>
</table>
<span class="target" id="module-mhkit.dolfyn.rotate.api"></span><dl class="py function">
<dt id="mhkit.dolfyn.rotate.api.rotate2">
<code class="sig-prename descclassname">mhkit.dolfyn.rotate.api.</code><code class="sig-name descname">rotate2</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ds</span></em>, <em class="sig-param"><span class="n">out_frame</span><span class="o">=</span><span class="default_value">'earth'</span></em>, <em class="sig-param"><span class="n">inplace</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/rotate/api.html#rotate2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mhkit.dolfyn.rotate.api.rotate2" title="Permalink to this definition">¶</a></dt>
<dd><p>Rotate a dataset to a new coordinate system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xr.Dataset</em>) – The dolfyn dataset (ADV or ADCP) to rotate.</p></li>
<li><p><strong>out_frame</strong> (<em>string {'beam'</em><em>, </em><em>'inst'</em><em>, </em><em>'earth'</em><em>, </em><em>'principal'}</em>) – The coordinate system to rotate the data into.</p></li>
<li><p><strong>inplace</strong> (<em>bool</em><em> (</em><em>default: True</em><em>)</em>) – When True <code class="docutils literal notranslate"><span class="pre">ds</span></code> is modified. When False a copy is returned.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset or None</em>) – Returns a new rotated dataset <strong>when ``inplace=False``</strong>, otherwise
returns None.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul>
<li><p>This function rotates all variables in <code class="docutils literal notranslate"><span class="pre">ds.attrs['rotate_vars']</span></code>.</p></li>
<li><p>In order to rotate to the ‘principal’ frame, a value should exist for
<code class="docutils literal notranslate"><span class="pre">ds.attrs['principal_heading']</span></code>. The function
<code class="xref py py-func docutils literal notranslate"><span class="pre">calc_principal_heading</span></code>
is recommended for this purpose, e.g.:</p>
<blockquote>
<div><p>ds.attrs[‘principal_heading’] = dolfyn.calc_principal_heading(ds[‘vel’].mean(range))</p>
</div></blockquote>
<p>where here we are using the depth-averaged velocity to calculate
the principal direction.</p>
</li>
</ul>
</dd></dl>

<dl class="py function">
<dt id="mhkit.dolfyn.rotate.api.calc_principal_heading">
<code class="sig-prename descclassname">mhkit.dolfyn.rotate.api.</code><code class="sig-name descname">calc_principal_heading</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">vel</span></em>, <em class="sig-param"><span class="n">tidal_mode</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/rotate/api.html#calc_principal_heading"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mhkit.dolfyn.rotate.api.calc_principal_heading" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the principal angle of the horizontal velocity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vel</strong> (<em>np.ndarray</em><em> (</em><em>2</em><em>,</em><em>..</em><em>,</em><em>Nt</em><em>)</em><em>, or </em><em>(</em><em>3</em><em>,</em><em>..</em><em>,</em><em>Nt</em><em>)</em>) – The 2D or 3D velocity array (3rd-dim is ignored in this calculation)</p></li>
<li><p><strong>tidal_mode</strong> (<em>bool</em><em> (</em><em>default: True</em><em>)</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>p_heading</strong> (<em>float or ndarray</em>) – The principal heading in degrees clockwise from North.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>When tidal_mode=True, this tool calculates the heading that is
aligned with the bidirectional flow. It does so following these
steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>rotates vectors with negative velocity by 180 degrees</p></li>
<li><p>then doubles those angles to make a complete circle again</p></li>
<li><p>computes a mean direction from this, and halves that angle
(to undo the doubled-angles in step 2)</p></li>
<li><p>The returned angle is forced to be between 0 and 180. So, you
may need to add 180 to this if you want your positive
direction to be in the western-half of the plane.</p></li>
</ol>
</div></blockquote>
<p>Otherwise, this function simply computes the average direction
using a vector method.</p>
</dd></dl>

<dl class="py function">
<dt id="mhkit.dolfyn.rotate.api.set_declination">
<code class="sig-prename descclassname">mhkit.dolfyn.rotate.api.</code><code class="sig-name descname">set_declination</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ds</span></em>, <em class="sig-param"><span class="n">declin</span></em>, <em class="sig-param"><span class="n">inplace</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/rotate/api.html#set_declination"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mhkit.dolfyn.rotate.api.set_declination" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the magnetic declination</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (xarray.Dataset or <code class="xref py py-class docutils literal notranslate"><span class="pre">dolfyn.velocity.Velocity</span></code>) – </p></li>
<li><p><strong>declination</strong> (<em>float</em>) – The value of the magnetic declination in degrees (positive
values specify that Magnetic North is clockwise from True North)</p></li>
<li><p><strong>inplace</strong> (<em>bool</em><em> (</em><em>default: True</em><em>)</em>) – When True <code class="docutils literal notranslate"><span class="pre">ds</span></code> is modified. When False a copy is returned.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset or None</em>) – Returns a new dataset with declination set <strong>when
``inplace=False``</strong>, otherwise returns None.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function modifies the data object in the following ways:</p>
<ul class="simple">
<li><p>If the dataset is in the <em>earth</em> reference frame at the time of
setting declination, it will be rotated into the “<em>True-East</em>,
<em>True-North</em>, Up” (hereafter, ETU) coordinate system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dat['orientmat']</span></code> is modified to be an ETU to
instrument (XYZ) rotation matrix (rather than the magnetic-ENU to
XYZ rotation matrix). Therefore, all rotations to/from the ‘earth’
frame will now be to/from this ETU coordinate system.</p></li>
<li><p>The value of the specified declination will be stored in
<code class="docutils literal notranslate"><span class="pre">dat.attrs['declination']</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dat['heading']</span></code> is adjusted for declination
(i.e., it is relative to True North).</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">dat.attrs['principal_heading']</span></code> is set, it is
adjusted to account for the orientation of the new ‘True’
earth coordinate system (i.e., calling set_declination on a
data object in the principal coordinate system, then calling
dat.rotate2(‘earth’) will yield a data object in the new
‘True’ earth coordinate system)</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt id="mhkit.dolfyn.rotate.api.set_inst2head_rotmat">
<code class="sig-prename descclassname">mhkit.dolfyn.rotate.api.</code><code class="sig-name descname">set_inst2head_rotmat</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ds</span></em>, <em class="sig-param"><span class="n">rotmat</span></em>, <em class="sig-param"><span class="n">inplace</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mhkit/dolfyn/rotate/api.html#set_inst2head_rotmat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mhkit.dolfyn.rotate.api.set_inst2head_rotmat" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the instrument to head rotation matrix for the Nortek ADV if it
hasn’t already been set through a ‘.userdata.json’ file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – The data set to assign inst2head_rotmat</p></li>
<li><p><strong>rotmat</strong> (<em>float</em>) – 3x3 rotation matrix</p></li>
<li><p><strong>inplace</strong> (<em>bool</em><em> (</em><em>default: True</em><em>)</em>) – When True <code class="docutils literal notranslate"><span class="pre">ds</span></code> is modified. When False a copy is returned.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ds</strong> (<em>xarray.Dataset or None</em>) – Returns a new dataset with inst2head_rotmat set <strong>when
``inplace=False``</strong>, otherwise returns None.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>If the data object is in earth or principal coords, it is first
rotated to ‘inst’ before assigning inst2head_rotmat, it is then
rotated back to the coordinate system in which it was input. This
way the inst2head_rotmat gets applied correctly (in inst
coordinate system).</p>
</dd></dl>

</div>
<div class="section" id="time">
<h2>Time<a class="headerlink" href="#time" title="Permalink to this headline">¶</a></h2>
<p>The time submodule contains functions to modify the format
of the stored time between a variety of time formats.</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">epoch2dt64</span></code></p></td>
<td><p>Convert from epoch time (seconds since 1/1/1970 00:00:00) to numpy.datetime64 array</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">dt642epoch</span></code></p></td>
<td><p>Convert numpy.datetime64 array to epoch time (seconds since 1/1/1970 00:00:00)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">date2dt64</span></code></p></td>
<td><p>Convert numpy.datetime64 array to list of datetime objects</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">dt642date</span></code></p></td>
<td><p>Convert numpy.datetime64 array to list of datetime objects</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">epoch2date</span></code></p></td>
<td><p>Convert from epoch time (seconds since 1/1/1970 00:00:00) to a list of datetime objects</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">date2str</span></code></p></td>
<td><p>Convert list of datetime objects to legible strings</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">date2epoch</span></code></p></td>
<td><p>Convert list of datetime objects to epoch time</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">date2matlab</span></code></p></td>
<td><p>Convert list of datetime objects to MATLAB datenum</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">matlab2date</span></code></p></td>
<td><p>Convert MATLAB datenum to list of datetime objects</p></td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.utils.html" class="btn btn-neutral float-right" title="Utils Module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="api.loads.html" class="btn btn-neutral float-left" title="Loads Module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, National Renewable Energy Laboratory, Pacific Northwest National Laboratory, and Sandia National Laboratories

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-164358105-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>